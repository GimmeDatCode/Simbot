const { Client } = require('pg');

const pgClient = new Client({
  connectionString: process.env.DATABASE_URL,
  ssl: true
  //connectionString: "postgres://:@localhost:5432/",
  //ssl: false,
});

pgClient.connect();

function updateUser(username,ships) {
  console.log("updateUser")
  pgClient.query("update users set ships=$1 WHERE username=$2;",[ships,username], (err, res) => {
    if (err) throw err;
  }); 
}

function setUser(username,ships) {
  console.log("setUser")
  pgClient.query("insert into users VALUES ($1,$2);",[username,ships], (err, res) => {
    if (err) throw err;
  }); 
}

function getUser(username,callback) {
  console.log("getUser")
  pgClient.query("SELECT * FROM users WHERE username=$1;",[username], (err, res) => {
    if (err) throw err;
    if(res.rows.length > 0) {
      ret = res.rows[0]['ships']
      callback(ret)
    } else {
      callback(null)
    }
  }); 
}

module.exports.getUser = getUser;
module.exports.setUser = setUser;
module.exports.updateUser = updateUser;
